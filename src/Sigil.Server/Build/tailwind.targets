<Project>
    <!-- Make sure Tailwind CLI exists -->
    <Target Name="EnsureTailwind" BeforeTargets="Build">
        <Message Text="Checking Tailwind CLI..." Importance="high" />

        <!-- Windows -->
        <Exec Command="powershell -ExecutionPolicy Bypass -File Build/check-tailwind.ps1"
              Condition="'$(OS)' == 'Windows_NT'" />

        <!-- Linux/Mac -->
        <Exec Command="bash Build/check-tailwind.sh"
              Condition="'$(OS)' != 'Windows_NT'" />
    </Target>

    <!-- Build Tailwind when building the project -->
    <Target Name="BuildTailwind" AfterTargets="EnsureTailwind" BeforeTargets="BeforeBuild">
        <Message Text="Running Tailwind production build..." Importance="high" />

        <!-- Windows -->
        <Exec Command="Tools\tailwindcss.exe -i Styles/input.css -o wwwroot/css/site.css --minify"
              Condition="'$(OS)' == 'Windows_NT'" />

        <!-- Linux/Mac -->
        <Exec Command="Tools/tailwindcss -i Styles/input.css -o wwwroot/css/site.css --minify"
              Condition="'$(OS)' != 'Windows_NT'" />

        <ItemGroup>
            <Content Remove="wwwroot\css\site.css" />
            <Content Include="wwwroot\css\site.css" CopyToPublishDirectory="PreserveNewest" />
        </ItemGroup>
    </Target>

</Project>